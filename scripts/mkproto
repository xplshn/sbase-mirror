#!/bin/sh

usage()
{
	echo mkproto: prefix manprefix proto>&2
	exit 1
}

prefix=${1?$(usage)}
manprefix=${2?$(usage)}
proto=${3?$(usage)}

trap "rm -f $proto" EXIT INT QUIT TERM

(set -e
echo d $prefix/bin $prefix/bin 755
echo d $manprefix/man1 $manprefix/man1 755
ls -ld * make/* |\
awk '
/^-/ && $1 ~ /x/ {
	base = $9
	sub(".*/", "", base)
	printf "c %s '$prefix/bin/'%s 755\n", $9, base
}
/^-/ && $9 ~ /\.1$/ {
	base = $9
	sub(".*/", "", base)
	printf "c %s '$manprefix/man1/'%s 644\n", $9, base
}') > $proto

trap "" EXIT INT QUIT TERM
